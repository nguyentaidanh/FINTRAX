

import React, { createContext, useState, ReactNode, useCallback } from 'react';

type Locale = 'en' | 'vi';
type Translations = { [key: string]: string };

// FIX: Define the I18nContextProps interface.
interface I18nContextProps {
  locale: Locale;
  changeLanguage: (lang: Locale) => void;
  t: (key: string) => string;
}

const translations: { [key in Locale]: Translations } = {
  en: {
    // General
    'dashboard': 'Dashboard', 'transactions': 'Transactions', 'tags': 'Tags', 'settings': 'Settings',
    'profile': 'Profile', 'logout': 'Logout', 'addTransaction': 'Add Transaction', 'addTag': 'Add Tag', 'edit': 'Edit',
    'delete': 'Delete', 'saveChanges': 'Save Changes', 'cancel': 'Cancel', 'accounts': 'Accounts',
    'calendar': 'Calendar', 'recurring': 'Recurring', 'close': 'Close', 'viewDetails': 'View Details',
    'analysis': 'Analysis', 'confirm': 'Confirm', 'previous': 'Previous', 'next': 'Next', 'viewAll': 'View All',
    'tryAgain': 'Try Again',
    // Dashboard
    'totalIncome': 'Total Income', 'totalExpenses': 'Total Expenses', 'balance': 'Balance',
    'allTimeIncome': 'All time income', 'allTimeExpenses': 'All time expenses', 'yourCurrentBalance': 'Your current balance',
    'incomeVsExpenses': 'Income vs. Expenses', 'monthlyFinancialOverview': 'Monthly financial overview.',
    'tagDistribution': 'Distribution by Tag', 'incomeExpenseByTag': 'Income sources and expense categories.',
    'noIncomeData': 'No income data to display.',
    'noExpenseData': 'No expense data to display.',
    'recentTransactions': 'Recent Transactions',
    'monthlyComparison': 'Monthly Comparison',
    'quarterlyComparison': 'Quarterly Comparison',
    'incomeVsExpenseBar': 'Side-by-side comparison of income and expenses.',
    'tagSpendingTrend': 'Tag Spending Trend',
    'spendingByTopTags': 'Spending trends for your top 5 tags over the last 6 months.',
    'periodComparison': 'Period Comparison',
    'monthly': 'Monthly',
    'quarterly': 'Quarterly',
    'vsLastMonth': 'vs. last month',
    'vsLastQuarter': 'vs. last quarter',
    'noPriorData': 'No prior period data',
    'activeGoals': 'Active Goals',
    'yourFinancialTargets': 'Your current financial targets',
    'quickLookGoals': 'A quick look at your top goals.',
    'noActiveGoals': 'No active goals yet. Why not set one up?',
    'overallGoalProgress': 'Overall Goal Progress',
    'allActiveGoalsCombined': 'Progress of all your active goals combined.',
    'ofYourTarget': 'of your target',
    'totalAssets': 'Total Assets',
    'sumOfAllAccounts': 'Sum of all account balances',
    'accountBalances': 'Account Balances',
    // Transactions Page
    'manageTransactions': 'Transactions', 'exportCSV': 'Export CSV', 'importCSV': 'Import CSV',
    'filterByDescription': 'Filter by description...', 'allTypes': 'All Types', 'income': 'Income', 'expense': 'Expense',
    'minAmount': 'Min Amount', 'maxAmount': 'Max Amount', 'filterByTags': 'Filter by Tags',
    'deleteSelected': 'Delete Selected', 'selected': 'selected',
    // Tags Page
    'manageTags': 'Manage Tags', 'yourTags': 'Your Tags', 'addNewTag': 'Add New Tag', 'editTag': 'Edit Tag',
    'tagName': 'Tag Name', 'color': 'Color',
    // Settings & Profile Page
    'userProfile': 'User Profile', 'profilePicture': 'Profile Picture', 'updateYourProfileInfo': 'Update your name, email, and avatar.',
    'changeAvatar': 'Change Avatar', 'avatarUploadHelp': 'JPG, PNG. 1MB max.', 'personalInformation': 'Personal Information',
    'managePersonalDetails': 'Manage your contact information and regional settings.', 'fullName': 'Full Name', 'emailAddress': 'Email Address',
    'phone': 'Phone Number', 'dateOfBirth': 'Date of Birth', 'currency': 'Preferred Currency', 'usd': 'USD - US Dollar', 'vnd': 'VND - Vietnamese Dong', 'eur': 'EUR - Euro',
    'security': 'Security', 'changePassword': 'Change Password', 'updatePasswordPrompt': 'Update your password here. Please enter your current password to proceed.',
    'currentPassword': 'Current Password', 'newPassword': 'New Password', 'confirmNewPassword': 'Confirm New Password',
    'appearance': 'Appearance', 'appearanceDescription': 'Customize the look and feel of the app.', 'language': 'Language', 'theme': 'Theme',
    'display': 'Display', 'displayDescription': 'Control how data is displayed in tables.', 'itemsPerPage': 'Items per page',
    'pageIndicator': 'Page {currentPage} of {totalPages}',
    'displaySettingsUpdated': 'Display settings updated!',
    // Login, Register, Forgot Password
    'welcomeMessage': 'Welcome to FinTrax', 'loginPrompt': 'Sign in to your account', 'login': 'Log In',
    'loggingIn': 'Logging In...', 'password': 'Password', 'forgotPasswordLink': 'Forgot password?',
    'dontHaveAccount': "Don't have an an account?", 'signUp': 'Sign Up', 'register': 'Register', 'registering': 'Registering...',
    'createAnAccount': 'Create an Account', 'startManagingFinances': 'Start managing your finances today.',
    'confirmPassword': 'Confirm Password', 'alreadyHaveAccount': 'Already have an account?', 'passwordReset': 'Password Reset',
    'passwordResetPrompt': 'Enter your email to get a reset link.', 'sendResetLink': 'Send Reset Link',
    'sending': 'Sending...', 'backToLogin': 'Back to Login', 'termsOfService': 'I agree to the Terms of Service and Privacy Policy.',
    // Toasts / Notifications
    'invalidCredentials': 'Invalid email or password.', 'passwordsDoNotMatch': 'Passwords do not match.',
    'emailInUse': 'An account with this email already exists.', 'registrationSuccess': 'Registration successful! Welcome.',
    'passwordResetSent': 'If an account exists, a reset link has been sent.', 'fillRequiredFields': 'Please fill all required fields.',
    'transactionAddedSuccess': 'Transaction added successfully', 'transactionUpdatedSuccess': 'Transaction updated successfully',
    'transactionDeletedSuccess': 'Transaction deleted successfully',
    'noTransactionsToExport': 'No transactions to export.', 'csvExportStarted': 'CSV export started!',
    'fileTooLarge': 'File is too large. Max 2MB.', 'noTagsAvailable': 'No tags available. Please add one first.',
    'accountNameRequired': 'Account name is required.', 'invalidInitialBalance': 'Initial balance must be a valid number.',
    'accountAddedSuccess': 'Account added successfully!', 'accountUpdatedSuccess': 'Account updated successfully!',
    'accountDeletedSuccess': 'Account deleted successfully.', 'cannotDeleteAccount': 'Cannot delete account with existing transactions.',
    'confirmDeleteAccount': 'Are you sure you want to delete this account? This action cannot be undone.',
    'confirmDeleteTransaction': 'Are you sure you want to delete this transaction?',
    'confirmDeletionTitle': 'Confirm Deletion',
    'confirmBulkDelete': 'Are you sure you want to delete the {count} selected transactions?',
    'bulkDeleteSuccess': 'Selected transactions deleted successfully.',
    'noTransactionsFound': 'No transactions found.', 'transactionsImported': 'transactions imported successfully!',
    'csvImportError': 'Error importing CSV file. Please check the format.',
    'recurringTransactionAddedSuccess': 'Recurring transaction added!', 'recurringTransactionUpdatedSuccess': 'Recurring transaction updated!',
    'recurringTransactionDeletedSuccess': 'Recurring transaction deleted.', 'confirmDeleteRecurring': 'Are you sure you want to delete this recurring transaction template?',
    'notificationSettingsUpdated': 'Notification settings updated!',
    'profileInfoUpdated': 'Profile information updated!', 'personalDetailsUpdated': 'Personal details updated!',
    'passwordUpdatedSuccess': 'Password updated successfully!', 'incorrectPassword': 'The current password you entered is incorrect.',
    // Transaction Modal & Details
    'editTransaction': 'Edit Transaction', 'type': 'Type', 'amount': 'Amount', 'taxPercent': 'Tax (%)',
    'description': 'Description', 'category': 'Category', 'date': 'Date', 'status': 'Status',
    'account': 'Account', 'selectAccount': '--- Select an Account ---', 'attachment': 'Attachment (Receipt)',
    'viewAttachment': 'View Attachment', 'fixed': 'Fixed', 'flexible': 'Flexible', 'investment': 'Investment',
    'savings': 'Savings', 'other': 'Other', 'paid': 'Paid', 'unpaid': 'Unpaid', 'debt': 'Debt', 'installment': 'Installment',
    'transactionDetails': 'Transaction Details', 'history': 'History', 'noHistoryFound': 'No history found.',
    'suggestedTags': 'AI Suggestions', 'suggesting': 'Suggesting...',
    // Table Headers
    'thDescription': 'Description', 'thAmount': 'Amount', 'thTags': 'Tags', 'thDate': 'Date', 'thActions': 'Actions', 'thStatus': 'Status',
    // Accounts Page
    'manageAccounts': 'Manage Accounts', 'addAccount': 'Add Account', 'editAccount': 'Edit Account',
    'accountName': 'Account Name', 'accountNamePlaceholder': 'e.g., Main Bank Account', 'accountType': 'Account Type',
    'initialBalance': 'Initial Balance', 'cash': 'Cash', 'bankaccount': 'Bank Account', 'e-wallet': 'E-Wallet',
    // Calendar Page
    'transactionsFor': 'Transactions for',
    // Import Modal
    'importTransactionsTitle': 'Import Transactions from CSV',
    'importInstructions': 'Select a CSV file to import. The file must follow a specific format.',
    'csvFormatNote': 'Columns: Date, Description, Amount, Type, Category, Status, Account, Tags (semicolon-separated)',
    // Recurring Transactions
    'manageRecurring': 'Manage Recurring Transactions', 'addRecurring': 'Add Recurring', 'editRecurring': 'Edit Recurring',
    'frequency': 'Frequency', 'startDate': 'Start Date', 'endDate': 'End Date (Optional)', 'nextDueDate': 'Next Due Date',
    // FIX: Removed duplicate 'monthly' key.
    'daily': 'Daily', 'weekly': 'Weekly', 'noRecurringFound': 'No recurring transaction templates found.', 'recurringDescription': 'Create and manage templates for automatic transaction generation.',
    // Notifications
    'notifications': 'Notifications', 'reminders': 'Reminders', 'upcomingRecurring': 'Upcoming Recurring Transactions',
    'enableRecurringReminders': 'Enable reminders for recurring transactions',
    'daysBeforeDueDate': 'Days before due date',
    'day': 'Day', 'days': 'Days', 'noNotifications': 'You have no new notifications.', 'markAllAsRead': 'Mark all as read',
    // Analysis Page
    'financialAnalysis': 'Financial Analysis',
    'analysisDescription': 'Compare financial performance across different periods.',
    'monthlyAnalysis': 'Monthly Analysis',
    'quarterlyAnalysis': 'Quarterly Analysis',
    'year': 'Year',
    'forTheYear': 'For the year {year}',
    'noDataForYear': 'No transaction data available for {year}.',
    'incomeForYear': 'Income (Year)',
    'expenseForYear': 'Expense (Year)',
    'balanceForYear': 'Balance (Year)',
    'totalSavedForYear': 'Total Saved Towards Goals',
    'goalContributions': 'Goal Contributions',
    'monthlyContributionsToGoals': 'Monthly contributions made towards all your financial goals.',
    'contributions': 'Contributions',
    'noContributionsForYear': 'No goal contributions were recorded for {year}.',
    'aiFinancialSummary': 'AI Financial Summary',
    'aiSummaryDescription': 'Get personalized insights and a summary of your financial activity for the selected year.',
    'generateAiSummary': 'Generate AI Summary',
    'generating': 'Generating...',
    'aiSummaryError': 'An error occurred while generating the summary. Please try again.',
    // Goals Page
    'goals': 'Financial Goals',
    'goalTrackingDescription': 'Set saving or spending targets and track your progress.',
    'addNewGoal': 'Add New Goal',
    'editGoal': 'Edit Goal',
    'goalName': 'Goal Name',
    'goalNamePlaceholder': 'e.g., Vacation Fund',
    'targetAmount': 'Target Amount',
    'currentAmount': 'Current Amount',
    'deadline': 'Deadline',
    'progress': 'Progress',
    'addContribution': 'Add Contribution',
    'addContributionTitle': 'Add Contribution to Goal',
    'contributionAmount': 'Contribution Amount',
    'contributionNote': 'This adds to your goal progress but does not create a transaction.',
    'goalAddedSuccess': 'Financial goal added successfully!',
    'goalUpdatedSuccess': 'Financial goal updated successfully!',
    'goalDeletedSuccess': 'Financial goal deleted.',
    'confirmDeleteGoal': 'Are you sure you want to delete this goal?',
    'completed': 'Completed',
    'active': 'Active',
    'overdue': 'Overdue',
    'daysLeft': '{days} days left',
    'daysOverdue': '{days} days overdue',
    'goalReached': 'Goal Reached!',
    'of': 'of',
    'allGoals': 'All Goals',
    'searchGoalPlaceholder': 'Search by goal name...',
    'totalActiveGoals': 'Active Goals',
    'amountSaved': 'Amount Saved',
    'overallProgress': 'Overall Progress',
    'noGoalsMatchFilters': 'No goals match the current filters.',
    'goalDetails': 'Goal Details',
    'backToList': 'Back to List',
    'noDescription': 'No description provided.',
    'confirmGoalCompletion': 'Confirm Goal Completion',
    'selectAccountForPayment': 'Select account for payment',
    'confirmGoalMessage': 'This will create an expense transaction for {amount}. Do you want to proceed?',
    'goalCompletedAndTransactionCreated': 'Goal completed and transaction created!',
    'manageContribution': 'Manage Contribution',
    'increase': 'Increase',
    'decrease': 'Decrease',
    'contributionCreatesTransaction': 'This will create an {type} transaction from the selected account.',
    'contributionHistory': 'Contribution History',
    'noContributions': 'No contributions have been made yet.',
    'contributionSuccess': 'Contribution successfully recorded.',
    'contributionTo': 'Contribution to "{goalName}"',
    'withdrawalFrom': 'Withdrawal from "{goalName}"',
    'contributionAdjustedIncrease': 'You only need {amount} to reach your goal. The contribution will be adjusted.',
    'contributionAdjustedDecrease': 'You can withdraw a maximum of {amount}. The withdrawal will be adjusted.',
    'insufficientFunds': "Insufficient funds in '{accountName}'.",
  },
  vi: {
    // General
    'dashboard': 'Bảng điều khiển', 'transactions': 'Giao dịch', 'tags': 'Thẻ', 'settings': 'Cài đặt',
    'profile': 'Hồ sơ', 'logout': 'Đăng xuất', 'addTransaction': 'Thêm giao dịch', 'addTag': 'Thêm thẻ', 'edit': 'Sửa',
    'delete': 'Xóa', 'saveChanges': 'Lưu thay đổi', 'cancel': 'Hủy', 'accounts': 'Tài khoản',
    'calendar': 'Lịch', 'recurring': 'Định kỳ', 'close': 'Đóng', 'viewDetails': 'Xem chi tiết',
    'analysis': 'Phân tích', 'confirm': 'Xác nhận', 'previous': 'Trước', 'next': 'Sau', 'viewAll': 'Xem tất cả',
    // Dashboard
    'totalIncome': 'Tổng thu nhập', 'totalExpenses': 'Tổng chi phí', 'balance': 'Số dư',
    'allTimeIncome': 'Thu nhập từ trước đến nay', 'allTimeExpenses': 'Chi phí từ trước đến nay', 'yourCurrentBalance': 'Số dư hiện tại của bạn',
    'incomeVsExpenses': 'Thu nhập và Chi phí', 'monthlyFinancialOverview': 'Tổng quan tài chính hàng tháng.',
    'tagDistribution': 'Phân bổ theo Thẻ', 'incomeExpenseByTag': 'Nguồn thu nhập và các hạng mục chi tiêu.',
    'noIncomeData': 'Không có dữ liệu thu nhập để hiển thị.',
    'noExpenseData': 'Không có dữ liệu chi tiêu để hiển thị.',
    'recentTransactions': 'Giao dịch gần đây',
    'monthlyComparison': 'So sánh hàng tháng',
    'quarterlyComparison': 'So sánh hàng quý',
    'incomeVsExpenseBar': 'So sánh trực quan thu nhập và chi phí.',
    'tagSpendingTrend': 'Xu hướng chi tiêu theo thẻ',
    'spendingByTopTags': 'Xu hướng chi tiêu cho 5 thẻ hàng đầu trong 6 tháng qua.',
    'periodComparison': 'So sánh Kỳ',
    'monthly': 'Hàng tháng',
    'quarterly': 'Hàng quý',
    'vsLastMonth': 'so với tháng trước',
    'vsLastQuarter': 'so với quý trước',
    'noPriorData': 'Không có dữ liệu kỳ trước',
    'activeGoals': 'Mục tiêu đang hoạt động',
    'yourFinancialTargets': 'Các mục tiêu tài chính hiện tại của bạn',
    'quickLookGoals': 'Xem nhanh các mục tiêu hàng đầu của bạn.',
    'noActiveGoals': 'Chưa có mục tiêu nào đang hoạt động. Sao không thử đặt một mục tiêu?',
    'overallGoalProgress': 'Tiến độ mục tiêu tổng thể',
    'allActiveGoalsCombined': 'Tiến độ của tất cả các mục tiêu đang hoạt động của bạn.',
    'ofYourTarget': 'trên mục tiêu của bạn',
    'totalAssets': 'Tổng tài sản',
    'sumOfAllAccounts': 'Tổng số dư các tài khoản',
    'accountBalances': 'Số dư tài khoản',
    // Transactions Page
    'manageTransactions': 'Giao dịch', 'exportCSV': 'Xuất CSV', 'importCSV': 'Nhập CSV',
    'filterByDescription': 'Lọc theo mô tả...', 'allTypes': 'Tất cả', 'income': 'Thu nhập', 'expense': 'Chi phí',
    'minAmount': 'Số tiền tối thiểu', 'maxAmount': 'Số tiền tối đa', 'filterByTags': 'Lọc theo Thẻ',
    'deleteSelected': 'Xóa mục đã chọn', 'selected': 'đã chọn',
    // Tags Page
    'manageTags': 'Quản lý Thẻ', 'yourTags': 'Thẻ của bạn', 'addNewTag': 'Thêm thẻ mới', 'editTag': 'Chỉnh sửa thẻ',
    'tagName': 'Tên thẻ', 'color': 'Màu sắc',
    // Settings & Profile Page
    'userProfile': 'Hồ sơ người dùng', 'profilePicture': 'Ảnh đại diện', 'updateYourProfileInfo': 'Cập nhật tên, email và ảnh đại diện của bạn.',
    'changeAvatar': 'Thay đổi ảnh đại diện', 'avatarUploadHelp': 'JPG, PNG. Tối đa 1MB.', 'personalInformation': 'Thông tin cá nhân',
    'managePersonalDetails': 'Quản lý thông tin liên hệ và cài đặt khu vực của bạn.', 'fullName': 'Họ và tên', 'emailAddress': 'Địa chỉ Email',
    'phone': 'Số điện thoại', 'dateOfBirth': 'Ngày sinh', 'currency': 'Tiền tệ ưu tiên', 'usd': 'USD - Đô la Mỹ', 'vnd': 'VND - Đồng Việt Nam', 'eur': 'EUR - Euro',
    'security': 'Bảo mật', 'changePassword': 'Đổi mật khẩu', 'updatePasswordPrompt': 'Cập nhật mật khẩu của bạn tại đây. Vui lòng nhập mật khẩu hiện tại để tiếp tục.',
    'currentPassword': 'Mật khẩu hiện tại', 'newPassword': 'Mật khẩu mới', 'confirmNewPassword': 'Xác nhận mật khẩu mới',
    'appearance': 'Giao diện', 'appearanceDescription': 'Tùy chỉnh giao diện và cảm nhận của ứng dụng.', 'language': 'Ngôn ngữ', 'theme': 'Chủ đề',
    'display': 'Hiển thị', 'displayDescription': 'Kiểm soát cách dữ liệu được hiển thị trong bảng.', 'itemsPerPage': 'Số mục mỗi trang',
    'pageIndicator': 'Trang {currentPage} trên {totalPages}',
    'displaySettingsUpdated': 'Đã cập nhật cài đặt hiển thị!',
    // Login, Register, Forgot Password
    'welcomeMessage': 'Chào mừng đến với FinTrax', 'loginPrompt': 'Đăng nhập vào tài khoản của bạn', 'login': 'Đăng nhập',
    'loggingIn': 'Đang đăng nhập...', 'password': 'Mật khẩu', 'forgotPasswordLink': 'Quên mật khẩu?',
    'dontHaveAccount': 'Chưa có tài khoản?', 'signUp': 'Đăng ký', 'register': 'Đăng ký', 'registering': 'Đang đăng ký...',
    'createAnAccount': 'Tạo tài khoản', 'startManagingFinances': 'Bắt đầu quản lý tài chính của bạn ngay hôm nay.',
    'confirmPassword': 'Xác nhận Mật khẩu', 'alreadyHaveAccount': 'Đã có tài khoản?', 'passwordReset': 'Đặt lại Mật khẩu',
    'passwordResetPrompt': 'Nhập email của bạn để nhận liên kết đặt lại.', 'sendResetLink': 'Gửi liên kết',
    'sending': 'Đang gửi...', 'backToLogin': 'Quay lại Đăng nhập', 'termsOfService': 'Tôi đồng ý với Điều khoản dịch vụ và Chính sách bảo mật.',
    // Toasts / Notifications
    'invalidCredentials': 'Email hoặc mật khẩu không hợp lệ.', 'passwordsDoNotMatch': 'Mật khẩu không khớp.',
    'emailInUse': 'Một tài khoản với email này đã tồn tại.', 'registrationSuccess': 'Đăng ký thành công! Chào mừng bạn.',
    'passwordResetSent': 'Nếu tài khoản tồn tại, một liên kết đặt lại đã được gửi.', 'fillRequiredFields': 'Vui lòng điền tất cả các trường bắt buộc.',
    'transactionAddedSuccess': 'Thêm giao dịch thành công', 'transactionUpdatedSuccess': 'Cập nhật giao dịch thành công',
    'transactionDeletedSuccess': 'Xóa giao dịch thành công',
    'noTransactionsToExport': 'Không có giao dịch nào để xuất.', 'csvExportStarted': 'Bắt đầu xuất file CSV!',
    'fileTooLarge': 'Tệp quá lớn. Tối đa 2MB.', 'noTagsAvailable': 'Không có thẻ nào. Vui lòng thêm thẻ trước.',
    'accountNameRequired': 'Tên tài khoản là bắt buộc.', 'invalidInitialBalance': 'Số dư ban đầu phải là một số hợp lệ.',
    'accountAddedSuccess': 'Thêm tài khoản thành công!', 'accountUpdatedSuccess': 'Cập nhật tài khoản thành công!',
    'accountDeletedSuccess': 'Đã xóa tài khoản.', 'cannotDeleteAccount': 'Không thể xóa tài khoản có giao dịch liên quan.',
    'confirmDeleteAccount': 'Bạn có chắc chắn muốn xóa tài khoản này? Hành động này không thể hoàn tác.',
    'confirmDeleteTransaction': 'Bạn có chắc muốn xóa giao dịch này?',
    'confirmDeletionTitle': 'Xác nhận Xóa',
    'confirmBulkDelete': 'Bạn có chắc chắn muốn xóa {count} giao dịch đã chọn không?',
    'bulkDeleteSuccess': 'Đã xóa thành công các giao dịch đã chọn.',
    'noTransactionsFound': 'Không tìm thấy giao dịch nào.', 'transactionsImported': 'giao dịch đã được nhập thành công!',
    'csvImportError': 'Lỗi nhập tệp CSV. Vui lòng kiểm tra định dạng.',
    'recurringTransactionAddedSuccess': 'Đã thêm giao dịch định kỳ!', 'recurringTransactionUpdatedSuccess': 'Đã cập nhật giao dịch định kỳ!',
    'recurringTransactionDeletedSuccess': 'Đã xóa giao dịch định kỳ.', 'confirmDeleteRecurring': 'Bạn có chắc chắn muốn xóa mẫu giao dịch định kỳ này không?',
    'notificationSettingsUpdated': 'Đã cập nhật cài đặt thông báo!',
    'profileInfoUpdated': 'Thông tin hồ sơ đã được cập nhật!', 'personalDetailsUpdated': 'Chi tiết cá nhân đã được cập nhật!',
    'passwordUpdatedSuccess': 'Mật khẩu đã được cập nhật thành công!', 'incorrectPassword': 'Mật khẩu hiện tại bạn nhập không chính xác.',
    // Transaction Modal & Details
    'editTransaction': 'Chỉnh sửa giao dịch', 'type': 'Loại', 'amount': 'Số tiền', 'taxPercent': 'Thuế (%)',
    'description': 'Mô tả', 'category': 'Danh mục', 'date': 'Ngày', 'status': 'Trạng thái',
    'account': 'Tài khoản', 'selectAccount': '--- Chọn một tài khoản ---', 'attachment': 'Đính kèm (Hóa đơn)',
    'viewAttachment': 'Xem tệp đính kèm', 'fixed': 'Cố định', 'flexible': 'Linh hoạt', 'investment': 'Đầu tư',
    'savings': 'Tiết kiệm', 'other': 'Khác', 'paid': 'Đã thanh toán', 'unpaid': 'Chưa thanh toán', 'debt': 'Ghi nợ', 'installment': 'Trả góp',
    'transactionDetails': 'Chi tiết Giao dịch', 'history': 'Lịch sử', 'noHistoryFound': 'Không tìm thấy lịch sử nào.',
    'suggestedTags': 'Gợi ý từ AI', 'suggesting': 'Đang gợi ý...',
    // Table Headers
    'thDescription': 'Mô tả', 'thAmount': 'Số tiền', 'thTags': 'Thẻ', 'thDate': 'Ngày', 'thActions': 'Hành động', 'thStatus': 'Trạng thái',
    // Accounts Page
    'manageAccounts': 'Quản lý Tài khoản', 'addAccount': 'Thêm tài khoản', 'editAccount': 'Sửa tài khoản',
    'accountName': 'Tên tài khoản', 'accountNamePlaceholder': 'VD: Tài khoản ngân hàng chính', 'accountType': 'Loại tài khoản',
    'initialBalance': 'Số dư ban đầu', 'cash': 'Tiền mặt', 'bankaccount': 'Tài khoản ngân hàng', 'e-wallet': 'Ví điện tử',
    // Calendar Page
    'transactionsFor': 'Giao dịch ngày',
    // Import Modal
    'importTransactionsTitle': 'Nhập giao dịch từ CSV',
    'importInstructions': 'Chọn tệp CSV để nhập. Tệp phải tuân theo một định dạng cụ thể.',
    'csvFormatNote': 'Các cột: Date, Description, Amount, Type, Category, Status, Account, Tags (phân cách bằng dấu chấm phẩy)',
    // Recurring Transactions
    'manageRecurring': 'Quản lý Giao dịch Định kỳ', 'addRecurring': 'Thêm Định kỳ', 'editRecurring': 'Sửa Giao dịch Định kỳ',
    'frequency': 'Tần suất', 'startDate': 'Ngày bắt đầu', 'endDate': 'Ngày kết thúc (Tùy chọn)', 'nextDueDate': 'Ngày đến hạn tiếp theo',
    // FIX: Removed duplicate 'monthly' key.
    'daily': 'Hàng ngày', 'weekly': 'Hàng tuần', 'noRecurringFound': 'Không tìm thấy mẫu giao dịch định kỳ nào.', 'recurringDescription': 'Tạo và quản lý các mẫu để tự động tạo giao dịch.',
     // Notifications
    'notifications': 'Thông báo', 'reminders': 'Lời nhắc', 'upcomingRecurring': 'Giao dịch định kỳ sắp tới',
    'enableRecurringReminders': 'Bật lời nhắc cho các giao dịch định kỳ',
    'daysBeforeDueDate': 'Số ngày trước hạn',
    'day': 'Ngày', 'days': 'Ngày', 'noNotifications': 'Bạn không có thông báo mới.', 'markAllAsRead': 'Đánh dấu tất cả là đã đọc',
     // Analysis Page
    'financialAnalysis': 'Phân tích tài chính',
    'analysisDescription': 'So sánh hiệu suất tài chính qua các kỳ khác nhau.',
    'monthlyAnalysis': 'Phân tích hàng tháng',
    'quarterlyAnalysis': 'Phân tích hàng quý',
    'year': 'Năm',
    'forTheYear': 'Cho năm {year}',
    'noDataForYear': 'Không có dữ liệu giao dịch cho năm {year}.',
    'incomeForYear': 'Thu nhập (Năm)',
    'expenseForYear': 'Chi phí (Năm)',
    'balanceForYear': 'Số dư (Năm)',
    'totalSavedForYear': 'Tổng tiết kiệm cho mục tiêu',
    'goalContributions': 'Đóng góp cho mục tiêu',
    'monthlyContributionsToGoals': 'Các khoản đóng góp hàng tháng cho tất cả các mục tiêu tài chính của bạn.',
    'contributions': 'Đóng góp',
    'noContributionsForYear': 'Không có khoản đóng góp mục tiêu nào được ghi nhận cho năm {year}.',
    'aiFinancialSummary': 'Tóm tắt tài chính bằng AI',
    'aiSummaryDescription': 'Nhận thông tin chi tiết được cá nhân hóa và tóm tắt hoạt động tài chính của bạn cho năm đã chọn.',
    'generateAiSummary': 'Tạo tóm tắt AI',
    'generating': 'Đang tạo...',
    'aiSummaryError': 'Đã xảy ra lỗi khi tạo tóm tắt. Vui lòng thử lại.',
    // Goals Page
    'goals': 'Mục tiêu tài chính',
    'goalTrackingDescription': 'Đặt mục tiêu tiết kiệm hoặc chi tiêu và theo dõi tiến độ của bạn.',
    'addNewGoal': 'Thêm mục tiêu mới',
    'editGoal': 'Chỉnh sửa mục tiêu',
    'goalName': 'Tên mục tiêu',
    'goalNamePlaceholder': 'VD: Quỹ du lịch',
    'targetAmount': 'Số tiền mục tiêu',
    'currentAmount': 'Số tiền hiện tại',
    'deadline': 'Hạn chót',
    'progress': 'Tiến độ',
    'addContribution': 'Thêm đóng góp',
    'addContributionTitle': 'Thêm đóng góp vào Mục tiêu',
    'contributionAmount': 'Số tiền đóng góp',
    'contributionNote': 'Số tiền này sẽ được cộng vào tiến độ mục tiêu nhưng không tạo giao dịch mới.',
    'goalAddedSuccess': 'Đã thêm mục tiêu tài chính thành công!',
    'goalUpdatedSuccess': 'Đã cập nhật mục tiêu tài chính thành công!',
    'goalDeletedSuccess': 'Đã xóa mục tiêu tài chính.',
    'confirmDeleteGoal': 'Bạn có chắc chắn muốn xóa mục tiêu này không?',
    'completed': 'Đã hoàn thành',
    'active': 'Đang hoạt động',
    'overdue': 'Quá hạn',
    'daysLeft': 'Còn lại {days} ngày',
    'daysOverdue': 'Quá hạn {days} ngày',
    'goalReached': 'Đã đạt mục tiêu!',
    'of': 'của',
    'allGoals': 'Tất cả mục tiêu',
    'searchGoalPlaceholder': 'Tìm kiếm theo tên mục tiêu...',
    'totalActiveGoals': 'Mục tiêu đang hoạt động',
    'amountSaved': 'Số tiền đã tiết kiệm',
    'overallProgress': 'Tiến độ tổng thể',
    'noGoalsMatchFilters': 'Không có mục tiêu nào khớp với bộ lọc hiện tại.',
    'goalDetails': 'Chi tiết mục tiêu',
    'backToList': 'Quay lại danh sách',
    'noDescription': 'Không có mô tả.',
    'confirmGoalCompletion': 'Xác nhận hoàn thành mục tiêu',
    'selectAccountForPayment': 'Chọn tài khoản để thanh toán',
    'confirmGoalMessage': 'Hành động này sẽ tạo một giao dịch chi phí là {amount}. Bạn có muốn tiếp tục?',
    'goalCompletedAndTransactionCreated': 'Mục tiêu đã hoàn thành và giao dịch đã được tạo!',
    'manageContribution': 'Quản lý Đóng góp',
    'increase': 'Tăng',
    'decrease': 'Giảm',
    'contributionCreatesTransaction': 'Hành động này sẽ tạo một giao dịch {type} từ tài khoản đã chọn.',
    'contributionHistory': 'Lịch sử Đóng góp',
    'noContributions': 'Chưa có đóng góp nào.',
    'contributionSuccess': 'Đã ghi nhận đóng góp thành công.',
    'contributionTo': 'Đóng góp cho "{goalName}"',
    'withdrawalFrom': 'Rút tiền từ "{goalName}"',
    'contributionAdjustedIncrease': "Bạn chỉ cần {amount} để đạt được mục tiêu. Khoản đóng góp sẽ được điều chỉnh.",
    'contributionAdjustedDecrease': "Bạn có thể rút tối đa {amount}. Khoản rút sẽ được điều chỉnh.",
    'insufficientFunds': "Không đủ số dư trong tài khoản '{accountName}'.",
  },
};

export const I18nContext = createContext<I18nContextProps | undefined>(undefined);

interface I18nProviderProps {
  children: ReactNode;
}

export const I18nProvider: React.FC<I18nProviderProps> = ({ children }) => {
  const [locale, setLocale] = useState<Locale>(() => (localStorage.getItem('locale') as Locale) || 'en');

  const changeLanguage = useCallback((lang: Locale) => {
    setLocale(lang);
    localStorage.setItem('locale', lang);
  }, []);

  const t = useCallback((key: string): string => {
    return translations[locale][key] || key;
  }, [locale]);

  return (
    <I18nContext.Provider value={{ locale, changeLanguage, t }}>
      {children}
    </I18nContext.Provider>
  );
};